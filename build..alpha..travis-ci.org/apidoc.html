<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="https://github.com/etsy/statsd"

    >statsd (v0.8.0)</a>
</h1>
<h4>Network daemon for the collection and aggregation of realtime application metrics</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.statsd">module statsd</a><ol>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">statsd.</span>config</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">statsd.</span>console</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">statsd.</span>graphite</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">statsd.</span>helpers</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">statsd.</span>logger</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">statsd.</span>mgmt_console</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">statsd.</span>mgmt_server</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">statsd.</span>process_metrics</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">statsd.</span>process_mgmt</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">statsd.</span>repeater</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">statsd.</span>set</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">statsd.</span>tcp</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">statsd.</span>udp</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.statsd.config">module statsd.config</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.config.Configurator">
            function <span class="apidocSignatureSpan">statsd.config.</span>Configurator
            <span class="apidocSignatureSpan">(file)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.config.configFile">
            function <span class="apidocSignatureSpan">statsd.config.</span>configFile
            <span class="apidocSignatureSpan">(file, callbackFunc)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.statsd.console">module statsd.console</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.console.init">
            function <span class="apidocSignatureSpan">statsd.console.</span>init
            <span class="apidocSignatureSpan">(startupTime, config, events)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.statsd.graphite">module statsd.graphite</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.graphite.init">
            function <span class="apidocSignatureSpan">statsd.graphite.</span>init
            <span class="apidocSignatureSpan">(startup_time, config, events, logger)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.statsd.helpers">module statsd.helpers</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.helpers.is_valid_packet">
            function <span class="apidocSignatureSpan">statsd.helpers.</span>is_valid_packet
            <span class="apidocSignatureSpan">(fields)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.helpers.writeConfig">
            function <span class="apidocSignatureSpan">statsd.helpers.</span>writeConfig
            <span class="apidocSignatureSpan">(config, stream)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.statsd.logger">module statsd.logger</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.logger.Logger">
            function <span class="apidocSignatureSpan">statsd.logger.</span>Logger
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.statsd.mgmt_console">module statsd.mgmt_console</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.mgmt_console.delete_stats">
            function <span class="apidocSignatureSpan">statsd.mgmt_console.</span>delete_stats
            <span class="apidocSignatureSpan">(stats_type, cmdline, stream)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.mgmt_console.existing_stats">
            function <span class="apidocSignatureSpan">statsd.mgmt_console.</span>existing_stats
            <span class="apidocSignatureSpan">(stats_type, bucket)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.statsd.mgmt_server">module statsd.mgmt_server</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.mgmt_server.start">
            function <span class="apidocSignatureSpan">statsd.mgmt_server.</span>start
            <span class="apidocSignatureSpan">(config, on_data_callback, on_error_callback)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.statsd.process_metrics">module statsd.process_metrics</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.process_metrics.process_metrics">
            function <span class="apidocSignatureSpan">statsd.</span>process_metrics
            <span class="apidocSignatureSpan">(metrics, flushInterval, ts, flushCallback)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.statsd.process_mgmt">module statsd.process_mgmt</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.process_mgmt.init">
            function <span class="apidocSignatureSpan">statsd.process_mgmt.</span>init
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.process_mgmt.set_title">
            function <span class="apidocSignatureSpan">statsd.process_mgmt.</span>set_title
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.statsd.repeater">module statsd.repeater</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.repeater.init">
            function <span class="apidocSignatureSpan">statsd.repeater.</span>init
            <span class="apidocSignatureSpan">(startupTime, config, emitter, logger)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.repeater.stop">
            function <span class="apidocSignatureSpan">statsd.repeater.</span>stop
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.statsd.set">module statsd.set</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.set.Set">
            function <span class="apidocSignatureSpan">statsd.set.</span>Set
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.statsd.tcp">module statsd.tcp</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.tcp.start">
            function <span class="apidocSignatureSpan">statsd.tcp.</span>start
            <span class="apidocSignatureSpan">(config, callback)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.statsd.udp">module statsd.udp</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.udp.start">
            function <span class="apidocSignatureSpan">statsd.udp.</span>start
            <span class="apidocSignatureSpan">(config, callback)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.statsd" id="apidoc.module.statsd">module statsd</a></h1>



























</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.statsd.config" id="apidoc.module.statsd.config">module statsd.config</a></h1>


    <h2>
        <a href="#apidoc.element.statsd.config.Configurator" id="apidoc.element.statsd.config.Configurator">
        function <span class="apidocSignatureSpan">statsd.config.</span>Configurator
        <span class="apidocSignatureSpan">(file)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Configurator = function (file) {

  var self = this;
  var config = {};
  var oldConfig = {};

  this.updateConfig = function () {
    util.log(&#x27;[&#x27; + process.pid + &#x27;] reading config file: &#x27; + file);

    fs.readFile(file, function (err, data) {
      if (err) { throw err; }
      old_config = self.config;

      self.config = eval(&#x27;config = &#x27; + data);
      self.emit(&#x27;configChanged&#x27;, self.config);
    });
  };

  this.updateConfig();

  fs.watch(file, function (event, filename) {
    if (event == &#x27;change&#x27; &#x26;&#x26; self.config.automaticConfigReload != false) {
      self.updateConfig();
    }
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.statsd.config.configFile" id="apidoc.element.statsd.config.configFile">
        function <span class="apidocSignatureSpan">statsd.config.</span>configFile
        <span class="apidocSignatureSpan">(file, callbackFunc)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">configFile = function (file, callbackFunc) {
  var config = new Configurator(file);
  config.on(&#x27;configChanged&#x27;, function() {
    callbackFunc(config.config, config.oldConfig);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.statsd.console" id="apidoc.module.statsd.console">module statsd.console</a></h1>


    <h2>
        <a href="#apidoc.element.statsd.console.init" id="apidoc.element.statsd.console.init">
        function <span class="apidocSignatureSpan">statsd.console.</span>init
        <span class="apidocSignatureSpan">(startupTime, config, events)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">init = function (startupTime, config, events) {
  var instance = new ConsoleBackend(startupTime, config, events);
  return true;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  this.backend = this.config.backend || &#x27;stdout&#x27;;
  this.level   = this.config.level || &#x22;LOG_INFO&#x22;;
  if (this.backend == &#x27;stdout&#x27;) {
    this.util = require(&#x27;util&#x27;);
  } else {
    if (this.backend == &#x27;syslog&#x27;) {
      this.util = require(&#x27;modern-syslog&#x27;);
      this.util.<span class="apidocCodeKeywordSpan">init</span>(config.application || &#x27;statsd&#x27;, this.util.LOG_PID | this
.util.LOG_ODELAY, this.util.LOG_LOCAL0);
    } else {
      throw &#x22;Logger: Should be &#x27;stdout&#x27; or &#x27;syslog&#x27;.&#x22;;
    }
  }
};

Logger.prototype = {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.statsd.graphite" id="apidoc.module.statsd.graphite">module statsd.graphite</a></h1>


    <h2>
        <a href="#apidoc.element.statsd.graphite.init" id="apidoc.element.statsd.graphite.init">
        function <span class="apidocSignatureSpan">statsd.graphite.</span>init
        <span class="apidocSignatureSpan">(startup_time, config, events, logger)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function graphite_init(startup_time, config, events, logger) {
  debug = config.debug;
  l = logger;
  graphiteHost = config.graphiteHost;
  graphitePort = config.graphitePort || 2003;
  graphitePicklePort = config.graphitePicklePort || 2004;
  graphiteProtocol = config.graphiteProtocol || &#x27;text&#x27;;
  config.graphite = config.graphite || {};
  globalPrefix    = config.graphite.globalPrefix;
  prefixCounter   = config.graphite.prefixCounter;
  prefixTimer     = config.graphite.prefixTimer;
  prefixGauge     = config.graphite.prefixGauge;
  prefixSet       = config.graphite.prefixSet;
  globalSuffix    = config.graphite.globalSuffix;
  legacyNamespace = config.graphite.legacyNamespace;
  prefixStats     = config.prefixStats;

  // set defaults for prefixes &#x26; suffix
  globalPrefix  = globalPrefix !== undefined ? globalPrefix : &#x22;stats&#x22;;
  prefixCounter = prefixCounter !== undefined ? prefixCounter : &#x22;counters&#x22;;
  prefixTimer   = prefixTimer !== undefined ? prefixTimer : &#x22;timers&#x22;;
  prefixGauge   = prefixGauge !== undefined ? prefixGauge : &#x22;gauges&#x22;;
  prefixSet     = prefixSet !== undefined ? prefixSet : &#x22;sets&#x22;;
  prefixStats   = prefixStats !== undefined ? prefixStats : &#x22;statsd&#x22;;
  legacyNamespace = legacyNamespace !== undefined ? legacyNamespace : true;

  // In order to unconditionally add this string, it either needs to be an
  // empty string if it was unset, OR prefixed by a . if it was set.
  globalSuffix  = globalSuffix !== undefined ? &#x27;.&#x27; + globalSuffix : &#x27;&#x27;;

  if (legacyNamespace === false) {
    if (globalPrefix !== &#x22;&#x22;) {
      globalNamespace.push(globalPrefix);
      counterNamespace.push(globalPrefix);
      timerNamespace.push(globalPrefix);
      gaugesNamespace.push(globalPrefix);
      setsNamespace.push(globalPrefix);
    }

    if (prefixCounter !== &#x22;&#x22;) {
      counterNamespace.push(prefixCounter);
    }
    if (prefixTimer !== &#x22;&#x22;) {
      timerNamespace.push(prefixTimer);
    }
    if (prefixGauge !== &#x22;&#x22;) {
      gaugesNamespace.push(prefixGauge);
    }
    if (prefixSet !== &#x22;&#x22;) {
      setsNamespace.push(prefixSet);
    }
  } else {
      globalNamespace = [&#x27;stats&#x27;];
      counterNamespace = [&#x27;stats&#x27;];
      timerNamespace = [&#x27;stats&#x27;, &#x27;timers&#x27;];
      gaugesNamespace = [&#x27;stats&#x27;, &#x27;gauges&#x27;];
      setsNamespace = [&#x27;stats&#x27;, &#x27;sets&#x27;];
  }

  graphiteStats.last_flush = startup_time;
  graphiteStats.last_exception = startup_time;
  graphiteStats.flush_time = 0;
  graphiteStats.flush_length = 0;

  if (config.keyNameSanitize !== undefined) {
    globalKeySanitize = config.keyNameSanitize;
  }

  flushInterval = config.flushInterval;

  flush_counts = typeof(config.flush_counts) === &#x22;undefined&#x22; ? true : config.flush_counts;

  events.on(&#x27;flush&#x27;, flush_stats);
  events.on(&#x27;status&#x27;, backend_status);

  return true;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  this.backend = this.config.backend || &#x27;stdout&#x27;;
  this.level   = this.config.level || &#x22;LOG_INFO&#x22;;
  if (this.backend == &#x27;stdout&#x27;) {
    this.util = require(&#x27;util&#x27;);
  } else {
    if (this.backend == &#x27;syslog&#x27;) {
      this.util = require(&#x27;modern-syslog&#x27;);
      this.util.<span class="apidocCodeKeywordSpan">init</span>(config.application || &#x27;statsd&#x27;, this.util.LOG_PID | this
.util.LOG_ODELAY, this.util.LOG_LOCAL0);
    } else {
      throw &#x22;Logger: Should be &#x27;stdout&#x27; or &#x27;syslog&#x27;.&#x22;;
    }
  }
};

Logger.prototype = {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.statsd.helpers" id="apidoc.module.statsd.helpers">module statsd.helpers</a></h1>


    <h2>
        <a href="#apidoc.element.statsd.helpers.is_valid_packet" id="apidoc.element.statsd.helpers.is_valid_packet">
        function <span class="apidocSignatureSpan">statsd.helpers.</span>is_valid_packet
        <span class="apidocSignatureSpan">(fields)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function is_valid_packet(fields) {

    // test for existing metrics type
    if (fields[1] === undefined) {
        return false;
    }

    // filter out malformed sample rates
    if(fields[2] !== undefined) {
        if(!isValidSampleRate(fields[2])) {
            return false;
        }
    }

    // filter out invalid metrics values
    switch(fields[1]) {
        case &#x27;s&#x27;:
            return true;
        case &#x27;g&#x27;:
            return isNumber(fields[0]);
        case &#x27;ms&#x27;:
            return isNumber(fields[0]) &#x26;&#x26; Number(fields[0]) &#x3e;= 0;
        default:
            if (!isNumber(fields[0])) {
                return false;
            }
            return true;
    }

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.statsd.helpers.writeConfig" id="apidoc.element.statsd.helpers.writeConfig">
        function <span class="apidocSignatureSpan">statsd.helpers.</span>writeConfig
        <span class="apidocSignatureSpan">(config, stream)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">writeConfig = function (config, stream) {
  stream.write(&#x22;\n&#x22;);
  for (var prop in config) {
    if (!config.hasOwnProperty(prop)) {
      continue;
    }
    if (typeof config[prop] !== &#x27;object&#x27;) {
      stream.write(prop + &#x22;: &#x22; + config[prop] + &#x22;\n&#x22;);
      continue;
    }
    var subconfig = config[prop];
    for (var subprop in subconfig) {
      if (!subconfig.hasOwnProperty(subprop)) {
        continue;
      }
      stream.write(prop + &#x22; &#x3e; &#x22; + subprop + &#x22;: &#x22; + subconfig[subprop] + &#x22;\n&#x22;);
    }
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.statsd.logger" id="apidoc.module.statsd.logger">module statsd.logger</a></h1>


    <h2>
        <a href="#apidoc.element.statsd.logger.Logger" id="apidoc.element.statsd.logger.Logger">
        function <span class="apidocSignatureSpan">statsd.logger.</span>Logger
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Logger = function (config) {
  this.config  = config;
  this.backend = this.config.backend || &#x27;stdout&#x27;;
  this.level   = this.config.level || &#x22;LOG_INFO&#x22;;
  if (this.backend == &#x27;stdout&#x27;) {
    this.util = require(&#x27;util&#x27;);
  } else {
    if (this.backend == &#x27;syslog&#x27;) {
      this.util = require(&#x27;modern-syslog&#x27;);
      this.util.init(config.application || &#x27;statsd&#x27;, this.util.LOG_PID | this.util.LOG_ODELAY, this.util.LOG_LOCAL0);
    } else {
      throw &#x22;Logger: Should be &#x27;stdout&#x27; or &#x27;syslog&#x27;.&#x22;;
    }
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.statsd.mgmt_console" id="apidoc.module.statsd.mgmt_console">module statsd.mgmt_console</a></h1>


    <h2>
        <a href="#apidoc.element.statsd.mgmt_console.delete_stats" id="apidoc.element.statsd.mgmt_console.delete_stats">
        function <span class="apidocSignatureSpan">statsd.mgmt_console.</span>delete_stats
        <span class="apidocSignatureSpan">(stats_type, cmdline, stream)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">delete_stats = function (stats_type, cmdline, stream) {

  //for each metric requested on the command line
  for (var index in cmdline) {

    //get a list of deletable metrics that match the request
    deletable = existing_stats(stats_type, cmdline[index]);

    //warn if no matches
    if (deletable.length === 0) {
      stream.write(&#x22;metric &#x22; + cmdline[index] + &#x22; not found\n&#x22;);
    }

    //delete all requested metrics
    for (var del_idx in deletable) {
      delete stats_type[deletable[del_idx]];
      stream.write(&#x22;deleted: &#x22; + deletable[del_idx] + &#x22;\n&#x22;);
    }
  }
  stream.write(&#x22;END\n\n&#x22;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.statsd.mgmt_console.existing_stats" id="apidoc.element.statsd.mgmt_console.existing_stats">
        function <span class="apidocSignatureSpan">statsd.mgmt_console.</span>existing_stats
        <span class="apidocSignatureSpan">(stats_type, bucket)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function existing_stats(stats_type, bucket){
  matches = [];

  //typical case: one-off, fully qualified
  if (bucket in stats_type) {
    matches.push(bucket);
  }

  //special case: match a whole &#x27;folder&#x27; (and subfolders) of stats
  if (bucket.slice(-2) == &#x22;.*&#x22;) {
    var folder = bucket.slice(0,-1);

    for (var name in stats_type) {
      //check if stat is in bucket, ie~ name starts with folder
      if (name.substring(0, folder.length) == folder) {
        matches.push(name);
      }
    }
  }

  return matches;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.statsd.mgmt_server" id="apidoc.module.statsd.mgmt_server">module statsd.mgmt_server</a></h1>


    <h2>
        <a href="#apidoc.element.statsd.mgmt_server.start" id="apidoc.element.statsd.mgmt_server.start">
        function <span class="apidocSignatureSpan">statsd.mgmt_server.</span>start
        <span class="apidocSignatureSpan">(config, on_data_callback, on_error_callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">start = function (config, on_data_callback, on_error_callback) {
  var server = net.createServer(function(stream) {
      stream.setEncoding(&#x27;ascii&#x27;);

      stream.on(&#x27;data&#x27;, function(data) {
        var cmdline = data.trim().split(&#x22; &#x22;);
        var cmd = cmdline.shift();

        on_data_callback(cmd, cmdline, stream);
      });

      stream.on(&#x27;error&#x27;, function(err) {
        on_error_callback(err, stream);
      });
  });

  server.listen(config.mgmt_port || 8126, config.mgmt_address || undefined);

  return true;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.statsd.process_metrics" id="apidoc.module.statsd.process_metrics">module statsd.process_metrics</a></h1>


    <h2>
        <a href="#apidoc.element.statsd.process_metrics.process_metrics" id="apidoc.element.statsd.process_metrics.process_metrics">
        function <span class="apidocSignatureSpan">statsd.</span>process_metrics
        <span class="apidocSignatureSpan">(metrics, flushInterval, ts, flushCallback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">process_metrics = function (metrics, flushInterval, ts, flushCallback) {
  var starttime = Date.now();
  var key;
  var counter_rates = {};
  var timer_data = {};
  var statsd_metrics = {};
  var counters = metrics.counters;
  var timers = metrics.timers;
  var timer_counters = metrics.timer_counters;
  var pctThreshold = metrics.pctThreshold;
  var histogram = metrics.histogram;

  for (key in counters) {
    var value = counters[key];

    // calculate &#x22;per second&#x22; rate
    counter_rates[key] = value / (flushInterval / 1000);
  }

  for (key in timers) {
    var current_timer_data = {};

    if (timers[key].length &#x3e; 0) {
      timer_data[key] = {};

      var values = timers[key].sort(function (a,b) { return a-b; });
      var count = values.length;
      var min = values[0];
      var max = values[count - 1];

      var cumulativeValues = [min];
      var cumulSumSquaresValues = [min * min];
      for (var i = 1; i &#x3c; count; i++) {
          cumulativeValues.push(values[i] + cumulativeValues[i-1]);
          cumulSumSquaresValues.push((values[i] * values[i]) +
                                     cumulSumSquaresValues[i - 1]);
      }

      var sum = min;
      var sumSquares = min * min;
      var mean = min;
      var thresholdBoundary = max;

      var key2;

      for (key2 in pctThreshold) {
        var pct = pctThreshold[key2];
        var numInThreshold = count;

        if (count &#x3e; 1) {
          numInThreshold = Math.round(Math.abs(pct) / 100 * count);
          if (numInThreshold === 0) {
            continue;
          }

          if (pct &#x3e; 0) {
            thresholdBoundary = values[numInThreshold - 1];
            sum = cumulativeValues[numInThreshold - 1];
            sumSquares = cumulSumSquaresValues[numInThreshold - 1];
          } else {
            thresholdBoundary = values[count - numInThreshold];
            sum = cumulativeValues[count - 1] - cumulativeValues[count - numInThreshold - 1];
            sumSquares = cumulSumSquaresValues[count - 1] -
              cumulSumSquaresValues[count - numInThreshold - 1];
          }
          mean = sum / numInThreshold;
        }

        var clean_pct = &#x27;&#x27; + pct;
        clean_pct = clean_pct.replace(&#x27;.&#x27;, &#x27;_&#x27;).replace(&#x27;-&#x27;, &#x27;top&#x27;);
        current_timer_data[&#x22;count_&#x22; + clean_pct] = numInThreshold;
        current_timer_data[&#x22;mean_&#x22; + clean_pct] = mean;
        current_timer_data[(pct &#x3e; 0 ? &#x22;upper_&#x22; : &#x22;lower_&#x22;) + clean_pct] = thresholdBoundary;
        current_timer_data[&#x22;sum_&#x22; + clean_pct] = sum;
        current_timer_data[&#x22;sum_squares_&#x22; + clean_pct] = sumSquares;

      }

      sum = cumulativeValues[count-1];
      sumSquares = cumulSumSquaresValues[count-1];
      mean = sum / count;

      var sumOfDiffs = 0;
      for (var i = 0; i &#x3c; count; i++) {
         sumOfDiffs += (values[i] - mean) * (values[i] - mean);
      }

      var mid = Math.floor(count/2);
      var median = (count % 2) ? values[mid] : (values[mid-1] + values[mid])/2;

      var stddev = Math.sqrt(sumOfDiffs / count);
      current_timer_data[&#x22;std&#x22;] = stddev;
      current_timer_data[&#x22;upper&#x22;] = max;
      current_timer_data[&#x22;lower&#x22;] = min;
      current_timer_data[&#x22;count&#x22;] = timer_counters[key];
      current_timer_data[&#x22;count_ps&#x22;] = timer_counters[key] / (flushInterval / 1000);
      current_timer_data[&#x22;sum&#x22;] = sum;
      current_timer_data[&#x22;sum_squares&#x22;] = sumSquares;
      current_timer_data[&#x22;mean&#x22;] = mean;
      current_timer_data[&#x22;median&#x22;] = median;

      // note: values bigger than the upper limit of the last bin are ignored, by design
      conf = histogram || [];
      bins = [];
      for (var i = 0; i &#x3c; conf.length; i++) {
          if (key.indexOf(conf[i].metric) &#x3e; -1) {
              bins = conf[i].bins;
              break;
          }
      }
      if(bins.length) {
          current_timer_data[&#x27;histogram&#x27;] = {};
      }
      // the outer loop iterates bins, the inner loop iterates timer values;
      // within each run of the inner loop we should only consider the timer value range that&#x27;s within the scope of the current
bin
      // so we leverage the fact that the values are alread ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.statsd.process_mgmt" id="apidoc.module.statsd.process_mgmt">module statsd.process_mgmt</a></h1>


    <h2>
        <a href="#apidoc.element.statsd.process_mgmt.init" id="apidoc.element.statsd.process_mgmt.init">
        function <span class="apidocSignatureSpan">statsd.process_mgmt.</span>init
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">init = function (config) {
  conf = config;
  exports.set_title(config);

  process.on(&#x27;SIGTERM&#x27;, function() {
   if (conf.debug) {
     util.log(&#x27;Starting Final Flush&#x27;);
   }
   healthStatus = &#x27;down&#x27;;
   process.exit();
  });

}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  this.backend = this.config.backend || &#x27;stdout&#x27;;
  this.level   = this.config.level || &#x22;LOG_INFO&#x22;;
  if (this.backend == &#x27;stdout&#x27;) {
    this.util = require(&#x27;util&#x27;);
  } else {
    if (this.backend == &#x27;syslog&#x27;) {
      this.util = require(&#x27;modern-syslog&#x27;);
      this.util.<span class="apidocCodeKeywordSpan">init</span>(config.application || &#x27;statsd&#x27;, this.util.LOG_PID | this
.util.LOG_ODELAY, this.util.LOG_LOCAL0);
    } else {
      throw &#x22;Logger: Should be &#x27;stdout&#x27; or &#x27;syslog&#x27;.&#x22;;
    }
  }
};

Logger.prototype = {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.statsd.process_mgmt.set_title" id="apidoc.element.statsd.process_mgmt.set_title">
        function <span class="apidocSignatureSpan">statsd.process_mgmt.</span>set_title
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">set_title = function (config) {
 if (config.title !== undefined) {
   if (config.title) {
       process.title = config.title;
   }
 } else {
   // Respect command line arguments when overriding the process title.
   cmdline = process.argv.slice(2);
   cmdline.unshift(&#x27;statsd&#x27;);

   process.title = cmdline.join(&#x22; &#x22;);
 }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

var util = require(&#x27;util&#x27;);

var conf;

exports.init = function(config) {
conf = config;
exports.<span class="apidocCodeKeywordSpan">set_title</span>(config);

process.on(&#x27;SIGTERM&#x27;, function() {
 if (conf.debug) {
   util.log(&#x27;Starting Final Flush&#x27;);
 }
 healthStatus = &#x27;down&#x27;;
 process.exit();
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.statsd.repeater" id="apidoc.module.statsd.repeater">module statsd.repeater</a></h1>


    <h2>
        <a href="#apidoc.element.statsd.repeater.init" id="apidoc.element.statsd.repeater.init">
        function <span class="apidocSignatureSpan">statsd.repeater.</span>init
        <span class="apidocSignatureSpan">(startupTime, config, emitter, logger)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">init = function (startupTime, config, emitter, logger) {
  debug = config.debug;
  l = logger;

  var proto = config.repeaterProtocol;
  if(proto == &#x27;tcp&#x27;) {
    instance = new TCPRepeaterBackend(startupTime, config, emitter);
  } else {
    instance = new UDPRepeaterBackend(startupTime, config, emitter);
  }

  return true;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  this.backend = this.config.backend || &#x27;stdout&#x27;;
  this.level   = this.config.level || &#x22;LOG_INFO&#x22;;
  if (this.backend == &#x27;stdout&#x27;) {
    this.util = require(&#x27;util&#x27;);
  } else {
    if (this.backend == &#x27;syslog&#x27;) {
      this.util = require(&#x27;modern-syslog&#x27;);
      this.util.<span class="apidocCodeKeywordSpan">init</span>(config.application || &#x27;statsd&#x27;, this.util.LOG_PID | this
.util.LOG_ODELAY, this.util.LOG_LOCAL0);
    } else {
      throw &#x22;Logger: Should be &#x27;stdout&#x27; or &#x27;syslog&#x27;.&#x22;;
    }
  }
};

Logger.prototype = {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.statsd.repeater.stop" id="apidoc.element.statsd.repeater.stop">
        function <span class="apidocSignatureSpan">statsd.repeater.</span>stop
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">stop = function (cb) {
  if(instance) {
    instance.stop(cb);
    instance = null;
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

  return true;
};


exports.stop = function(cb) {
  if(instance) {
    instance.<span class="apidocCodeKeywordSpan">stop</span>(cb);
    instance = null;
  }
};
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.statsd.set" id="apidoc.module.statsd.set">module statsd.set</a></h1>


    <h2>
        <a href="#apidoc.element.statsd.set.Set" id="apidoc.element.statsd.set.Set">
        function <span class="apidocSignatureSpan">statsd.set.</span>Set
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Set = function () {
  this.store = {};
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.statsd.tcp" id="apidoc.module.statsd.tcp">module statsd.tcp</a></h1>


    <h2>
        <a href="#apidoc.element.statsd.tcp.start" id="apidoc.element.statsd.tcp.start">
        function <span class="apidocSignatureSpan">statsd.tcp.</span>start
        <span class="apidocSignatureSpan">(config, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">start = function (config, callback) {
  var server = net.createServer(function(stream) {
      stream.setEncoding(&#x27;ascii&#x27;);

      var buffer = &#x27;&#x27;;
      stream.on(&#x27;data&#x27;, function(data) {
          buffer += data;
          var offset = buffer.lastIndexOf(&#x22;\n&#x22;);
          if (offset &#x3e; -1) {
             var packet = buffer.slice(0, offset + 1);
             buffer = buffer.slice(offset + 1);
             callback(packet, new rinfo(stream, packet));
          }
      });
  });

  server.on(&#x27;listening&#x27;, function() {
    config.socket &#x26;&#x26; config.socket_mod &#x26;&#x26; fs.chmod(config.socket, config.socket_mod);
  });

  process.on(&#x27;exit&#x27;, function() {
      config.socket &#x26;&#x26; fs.unlinkSync(config.socket);
  });

  server.listen(config.socket || config.port || 8125, config.address || undefined);
  this.server = server;
  return true;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.statsd.udp" id="apidoc.module.statsd.udp">module statsd.udp</a></h1>


    <h2>
        <a href="#apidoc.element.statsd.udp.start" id="apidoc.element.statsd.udp.start">
        function <span class="apidocSignatureSpan">statsd.udp.</span>start
        <span class="apidocSignatureSpan">(config, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">start = function (config, callback) {
  var udp_version = config.address_ipv6 ? &#x27;udp6&#x27; : &#x27;udp4&#x27;;
  var server = dgram.createSocket(udp_version, callback);

  server.bind(config.port || 8125, config.address || undefined);
  this.server = server;

  return true;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
