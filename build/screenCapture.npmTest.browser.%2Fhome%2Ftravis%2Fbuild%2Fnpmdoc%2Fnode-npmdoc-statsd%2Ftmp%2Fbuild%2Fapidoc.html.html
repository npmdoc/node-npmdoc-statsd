<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a href="https://github.com/etsy/statsd">statsd (v0.8.0)</a>
</h1>
<h4>Network daemon for the collection and aggregation of realtime application metrics</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.statsd">module statsd</a><ol>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">statsd.</span>config</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">statsd.</span>console</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">statsd.</span>graphite</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">statsd.</span>helpers</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">statsd.</span>logger</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">statsd.</span>mgmt_console</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">statsd.</span>mgmt_server</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">statsd.</span>process_metrics</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">statsd.</span>process_mgmt</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">statsd.</span>repeater</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">statsd.</span>set</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">statsd.</span>tcp</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">statsd.</span>udp</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.statsd.config">module statsd.config</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.config.Configurator">
            function <span class="apidocSignatureSpan">statsd.config.</span>Configurator
            <span class="apidocSignatureSpan">(file)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.config.configFile">
            function <span class="apidocSignatureSpan">statsd.config.</span>configFile
            <span class="apidocSignatureSpan">(file, callbackFunc)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.statsd.console">module statsd.console</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.console.init">
            function <span class="apidocSignatureSpan">statsd.console.</span>init
            <span class="apidocSignatureSpan">(startupTime, config, events)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.statsd.graphite">module statsd.graphite</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.graphite.init">
            function <span class="apidocSignatureSpan">statsd.graphite.</span>init
            <span class="apidocSignatureSpan">(startup_time, config, events, logger)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.statsd.helpers">module statsd.helpers</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.helpers.is_valid_packet">
            function <span class="apidocSignatureSpan">statsd.helpers.</span>is_valid_packet
            <span class="apidocSignatureSpan">(fields)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.helpers.writeConfig">
            function <span class="apidocSignatureSpan">statsd.helpers.</span>writeConfig
            <span class="apidocSignatureSpan">(config, stream)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.statsd.logger">module statsd.logger</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.logger.Logger">
            function <span class="apidocSignatureSpan">statsd.logger.</span>Logger
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.statsd.mgmt_console">module statsd.mgmt_console</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.mgmt_console.delete_stats">
            function <span class="apidocSignatureSpan">statsd.mgmt_console.</span>delete_stats
            <span class="apidocSignatureSpan">(stats_type, cmdline, stream)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.mgmt_console.existing_stats">
            function <span class="apidocSignatureSpan">statsd.mgmt_console.</span>existing_stats
            <span class="apidocSignatureSpan">(stats_type, bucket)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.statsd.mgmt_server">module statsd.mgmt_server</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.mgmt_server.start">
            function <span class="apidocSignatureSpan">statsd.mgmt_server.</span>start
            <span class="apidocSignatureSpan">(config, on_data_callback, on_error_callback)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.statsd.process_metrics">module statsd.process_metrics</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.process_metrics.process_metrics">
            function <span class="apidocSignatureSpan">statsd.</span>process_metrics
            <span class="apidocSignatureSpan">(metrics, flushInterval, ts, flushCallback)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.statsd.process_mgmt">module statsd.process_mgmt</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.process_mgmt.init">
            function <span class="apidocSignatureSpan">statsd.process_mgmt.</span>init
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.process_mgmt.set_title">
            function <span class="apidocSignatureSpan">statsd.process_mgmt.</span>set_title
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.statsd.repeater">module statsd.repeater</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.repeater.init">
            function <span class="apidocSignatureSpan">statsd.repeater.</span>init
            <span class="apidocSignatureSpan">(startupTime, config, emitter, logger)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.repeater.stop">
            function <span class="apidocSignatureSpan">statsd.repeater.</span>stop
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.statsd.set">module statsd.set</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.set.Set">
            function <span class="apidocSignatureSpan">statsd.set.</span>Set
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.statsd.tcp">module statsd.tcp</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.tcp.start">
            function <span class="apidocSignatureSpan">statsd.tcp.</span>start
            <span class="apidocSignatureSpan">(config, callback)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.statsd.udp">module statsd.udp</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.statsd.udp.start">
            function <span class="apidocSignatureSpan">statsd.udp.</span>start
            <span class="apidocSignatureSpan">(config, callback)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.statsd" id="apidoc.module.statsd">module statsd</a></h1>



























</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.statsd.config" id="apidoc.module.statsd.config">module statsd.config</a></h1>


    <h2>
        <a href="#apidoc.element.statsd.config.Configurator" id="apidoc.element.statsd.config.Configurator">
        function <span class="apidocSignatureSpan">statsd.config.</span>Configurator
        <span class="apidocSignatureSpan">(file)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Configurator = function (file) {

  var self = this;
  var config = {};
  var oldConfig = {};

  this.updateConfig = function () {
    util.log('[' + process.pid + '] reading config file: ' + file);

    fs.readFile(file, function (err, data) {
      if (err) { throw err; }
      old_config = self.config;

      self.config = eval('config = ' + data);
      self.emit('configChanged', self.config);
    });
  };

  this.updateConfig();

  fs.watch(file, function (event, filename) {
    if (event == 'change' &amp;&amp; self.config.automaticConfigReload != false) {
      self.updateConfig();
    }
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.statsd.config.configFile" id="apidoc.element.statsd.config.configFile">
        function <span class="apidocSignatureSpan">statsd.config.</span>configFile
        <span class="apidocSignatureSpan">(file, callbackFunc)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">configFile = function (file, callbackFunc) {
  var config = new Configurator(file);
  config.on('configChanged', function() {
    callbackFunc(config.config, config.oldConfig);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.statsd.console" id="apidoc.module.statsd.console">module statsd.console</a></h1>


    <h2>
        <a href="#apidoc.element.statsd.console.init" id="apidoc.element.statsd.console.init">
        function <span class="apidocSignatureSpan">statsd.console.</span>init
        <span class="apidocSignatureSpan">(startupTime, config, events)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">init = function (startupTime, config, events) {
  var instance = new ConsoleBackend(startupTime, config, events);
  return true;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  this.backend = this.config.backend || 'stdout';
  this.level   = this.config.level || "LOG_INFO";
  if (this.backend == 'stdout') {
    this.util = require('util');
  } else {
    if (this.backend == 'syslog') {
      this.util = require('modern-syslog');
      this.util.<span class="apidocCodeKeywordSpan">init</span>(config.application || 'statsd', this.util.LOG_PID | this
.util.LOG_ODELAY, this.util.LOG_LOCAL0);
    } else {
      throw "Logger: Should be 'stdout' or 'syslog'.";
    }
  }
};

Logger.prototype = {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.statsd.graphite" id="apidoc.module.statsd.graphite">module statsd.graphite</a></h1>


    <h2>
        <a href="#apidoc.element.statsd.graphite.init" id="apidoc.element.statsd.graphite.init">
        function <span class="apidocSignatureSpan">statsd.graphite.</span>init
        <span class="apidocSignatureSpan">(startup_time, config, events, logger)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function graphite_init(startup_time, config, events, logger) {
  debug = config.debug;
  l = logger;
  graphiteHost = config.graphiteHost;
  graphitePort = config.graphitePort || 2003;
  graphitePicklePort = config.graphitePicklePort || 2004;
  graphiteProtocol = config.graphiteProtocol || 'text';
  config.graphite = config.graphite || {};
  globalPrefix    = config.graphite.globalPrefix;
  prefixCounter   = config.graphite.prefixCounter;
  prefixTimer     = config.graphite.prefixTimer;
  prefixGauge     = config.graphite.prefixGauge;
  prefixSet       = config.graphite.prefixSet;
  globalSuffix    = config.graphite.globalSuffix;
  legacyNamespace = config.graphite.legacyNamespace;
  prefixStats     = config.prefixStats;

  // set defaults for prefixes &amp; suffix
  globalPrefix  = globalPrefix !== undefined ? globalPrefix : "stats";
  prefixCounter = prefixCounter !== undefined ? prefixCounter : "counters";
  prefixTimer   = prefixTimer !== undefined ? prefixTimer : "timers";
  prefixGauge   = prefixGauge !== undefined ? prefixGauge : "gauges";
  prefixSet     = prefixSet !== undefined ? prefixSet : "sets";
  prefixStats   = prefixStats !== undefined ? prefixStats : "statsd";
  legacyNamespace = legacyNamespace !== undefined ? legacyNamespace : true;

  // In order to unconditionally add this string, it either needs to be an
  // empty string if it was unset, OR prefixed by a . if it was set.
  globalSuffix  = globalSuffix !== undefined ? '.' + globalSuffix : '';

  if (legacyNamespace === false) {
    if (globalPrefix !== "") {
      globalNamespace.push(globalPrefix);
      counterNamespace.push(globalPrefix);
      timerNamespace.push(globalPrefix);
      gaugesNamespace.push(globalPrefix);
      setsNamespace.push(globalPrefix);
    }

    if (prefixCounter !== "") {
      counterNamespace.push(prefixCounter);
    }
    if (prefixTimer !== "") {
      timerNamespace.push(prefixTimer);
    }
    if (prefixGauge !== "") {
      gaugesNamespace.push(prefixGauge);
    }
    if (prefixSet !== "") {
      setsNamespace.push(prefixSet);
    }
  } else {
      globalNamespace = ['stats'];
      counterNamespace = ['stats'];
      timerNamespace = ['stats', 'timers'];
      gaugesNamespace = ['stats', 'gauges'];
      setsNamespace = ['stats', 'sets'];
  }

  graphiteStats.last_flush = startup_time;
  graphiteStats.last_exception = startup_time;
  graphiteStats.flush_time = 0;
  graphiteStats.flush_length = 0;

  if (config.keyNameSanitize !== undefined) {
    globalKeySanitize = config.keyNameSanitize;
  }

  flushInterval = config.flushInterval;

  flush_counts = typeof(config.flush_counts) === "undefined" ? true : config.flush_counts;

  events.on('flush', flush_stats);
  events.on('status', backend_status);

  return true;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  this.backend = this.config.backend || 'stdout';
  this.level   = this.config.level || "LOG_INFO";
  if (this.backend == 'stdout') {
    this.util = require('util');
  } else {
    if (this.backend == 'syslog') {
      this.util = require('modern-syslog');
      this.util.<span class="apidocCodeKeywordSpan">init</span>(config.application || 'statsd', this.util.LOG_PID | this
.util.LOG_ODELAY, this.util.LOG_LOCAL0);
    } else {
      throw "Logger: Should be 'stdout' or 'syslog'.";
    }
  }
};

Logger.prototype = {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.statsd.helpers" id="apidoc.module.statsd.helpers">module statsd.helpers</a></h1>


    <h2>
        <a href="#apidoc.element.statsd.helpers.is_valid_packet" id="apidoc.element.statsd.helpers.is_valid_packet">
        function <span class="apidocSignatureSpan">statsd.helpers.</span>is_valid_packet
        <span class="apidocSignatureSpan">(fields)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function is_valid_packet(fields) {

    // test for existing metrics type
    if (fields[1] === undefined) {
        return false;
    }

    // filter out malformed sample rates
    if(fields[2] !== undefined) {
        if(!isValidSampleRate(fields[2])) {
            return false;
        }
    }

    // filter out invalid metrics values
    switch(fields[1]) {
        case 's':
            return true;
        case 'g':
            return isNumber(fields[0]);
        case 'ms':
            return isNumber(fields[0]) &amp;&amp; Number(fields[0]) &gt;= 0;
        default:
            if (!isNumber(fields[0])) {
                return false;
            }
            return true;
    }

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.statsd.helpers.writeConfig" id="apidoc.element.statsd.helpers.writeConfig">
        function <span class="apidocSignatureSpan">statsd.helpers.</span>writeConfig
        <span class="apidocSignatureSpan">(config, stream)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">writeConfig = function (config, stream) {
  stream.write("\n");
  for (var prop in config) {
    if (!config.hasOwnProperty(prop)) {
      continue;
    }
    if (typeof config[prop] !== 'object') {
      stream.write(prop + ": " + config[prop] + "\n");
      continue;
    }
    var subconfig = config[prop];
    for (var subprop in subconfig) {
      if (!subconfig.hasOwnProperty(subprop)) {
        continue;
      }
      stream.write(prop + " &gt; " + subprop + ": " + subconfig[subprop] + "\n");
    }
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.statsd.logger" id="apidoc.module.statsd.logger">module statsd.logger</a></h1>


    <h2>
        <a href="#apidoc.element.statsd.logger.Logger" id="apidoc.element.statsd.logger.Logger">
        function <span class="apidocSignatureSpan">statsd.logger.</span>Logger
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Logger = function (config) {
  this.config  = config;
  this.backend = this.config.backend || 'stdout';
  this.level   = this.config.level || "LOG_INFO";
  if (this.backend == 'stdout') {
    this.util = require('util');
  } else {
    if (this.backend == 'syslog') {
      this.util = require('modern-syslog');
      this.util.init(config.application || 'statsd', this.util.LOG_PID | this.util.LOG_ODELAY, this.util.LOG_LOCAL0);
    } else {
      throw "Logger: Should be 'stdout' or 'syslog'.";
    }
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.statsd.mgmt_console" id="apidoc.module.statsd.mgmt_console">module statsd.mgmt_console</a></h1>


    <h2>
        <a href="#apidoc.element.statsd.mgmt_console.delete_stats" id="apidoc.element.statsd.mgmt_console.delete_stats">
        function <span class="apidocSignatureSpan">statsd.mgmt_console.</span>delete_stats
        <span class="apidocSignatureSpan">(stats_type, cmdline, stream)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">delete_stats = function (stats_type, cmdline, stream) {

  //for each metric requested on the command line
  for (var index in cmdline) {

    //get a list of deletable metrics that match the request
    deletable = existing_stats(stats_type, cmdline[index]);

    //warn if no matches
    if (deletable.length === 0) {
      stream.write("metric " + cmdline[index] + " not found\n");
    }

    //delete all requested metrics
    for (var del_idx in deletable) {
      delete stats_type[deletable[del_idx]];
      stream.write("deleted: " + deletable[del_idx] + "\n");
    }
  }
  stream.write("END\n\n");
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.statsd.mgmt_console.existing_stats" id="apidoc.element.statsd.mgmt_console.existing_stats">
        function <span class="apidocSignatureSpan">statsd.mgmt_console.</span>existing_stats
        <span class="apidocSignatureSpan">(stats_type, bucket)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function existing_stats(stats_type, bucket){
  matches = [];

  //typical case: one-off, fully qualified
  if (bucket in stats_type) {
    matches.push(bucket);
  }

  //special case: match a whole 'folder' (and subfolders) of stats
  if (bucket.slice(-2) == ".*") {
    var folder = bucket.slice(0,-1);

    for (var name in stats_type) {
      //check if stat is in bucket, ie~ name starts with folder
      if (name.substring(0, folder.length) == folder) {
        matches.push(name);
      }
    }
  }

  return matches;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.statsd.mgmt_server" id="apidoc.module.statsd.mgmt_server">module statsd.mgmt_server</a></h1>


    <h2>
        <a href="#apidoc.element.statsd.mgmt_server.start" id="apidoc.element.statsd.mgmt_server.start">
        function <span class="apidocSignatureSpan">statsd.mgmt_server.</span>start
        <span class="apidocSignatureSpan">(config, on_data_callback, on_error_callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">start = function (config, on_data_callback, on_error_callback) {
  var server = net.createServer(function(stream) {
      stream.setEncoding('ascii');

      stream.on('data', function(data) {
        var cmdline = data.trim().split(" ");
        var cmd = cmdline.shift();

        on_data_callback(cmd, cmdline, stream);
      });

      stream.on('error', function(err) {
        on_error_callback(err, stream);
      });
  });

  server.listen(config.mgmt_port || 8126, config.mgmt_address || undefined);

  return true;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.statsd.process_metrics" id="apidoc.module.statsd.process_metrics">module statsd.process_metrics</a></h1>


    <h2>
        <a href="#apidoc.element.statsd.process_metrics.process_metrics" id="apidoc.element.statsd.process_metrics.process_metrics">
        function <span class="apidocSignatureSpan">statsd.</span>process_metrics
        <span class="apidocSignatureSpan">(metrics, flushInterval, ts, flushCallback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">process_metrics = function (metrics, flushInterval, ts, flushCallback) {
  var starttime = Date.now();
  var key;
  var counter_rates = {};
  var timer_data = {};
  var statsd_metrics = {};
  var counters = metrics.counters;
  var timers = metrics.timers;
  var timer_counters = metrics.timer_counters;
  var pctThreshold = metrics.pctThreshold;
  var histogram = metrics.histogram;

  for (key in counters) {
    var value = counters[key];

    // calculate "per second" rate
    counter_rates[key] = value / (flushInterval / 1000);
  }

  for (key in timers) {
    var current_timer_data = {};

    if (timers[key].length &gt; 0) {
      timer_data[key] = {};

      var values = timers[key].sort(function (a,b) { return a-b; });
      var count = values.length;
      var min = values[0];
      var max = values[count - 1];

      var cumulativeValues = [min];
      var cumulSumSquaresValues = [min * min];
      for (var i = 1; i &lt; count; i++) {
          cumulativeValues.push(values[i] + cumulativeValues[i-1]);
          cumulSumSquaresValues.push((values[i] * values[i]) +
                                     cumulSumSquaresValues[i - 1]);
      }

      var sum = min;
      var sumSquares = min * min;
      var mean = min;
      var thresholdBoundary = max;

      var key2;

      for (key2 in pctThreshold) {
        var pct = pctThreshold[key2];
        var numInThreshold = count;

        if (count &gt; 1) {
          numInThreshold = Math.round(Math.abs(pct) / 100 * count);
          if (numInThreshold === 0) {
            continue;
          }

          if (pct &gt; 0) {
            thresholdBoundary = values[numInThreshold - 1];
            sum = cumulativeValues[numInThreshold - 1];
            sumSquares = cumulSumSquaresValues[numInThreshold - 1];
          } else {
            thresholdBoundary = values[count - numInThreshold];
            sum = cumulativeValues[count - 1] - cumulativeValues[count - numInThreshold - 1];
            sumSquares = cumulSumSquaresValues[count - 1] -
              cumulSumSquaresValues[count - numInThreshold - 1];
          }
          mean = sum / numInThreshold;
        }

        var clean_pct = '' + pct;
        clean_pct = clean_pct.replace('.', '_').replace('-', 'top');
        current_timer_data["count_" + clean_pct] = numInThreshold;
        current_timer_data["mean_" + clean_pct] = mean;
        current_timer_data[(pct &gt; 0 ? "upper_" : "lower_") + clean_pct] = thresholdBoundary;
        current_timer_data["sum_" + clean_pct] = sum;
        current_timer_data["sum_squares_" + clean_pct] = sumSquares;

      }

      sum = cumulativeValues[count-1];
      sumSquares = cumulSumSquaresValues[count-1];
      mean = sum / count;

      var sumOfDiffs = 0;
      for (var i = 0; i &lt; count; i++) {
         sumOfDiffs += (values[i] - mean) * (values[i] - mean);
      }

      var mid = Math.floor(count/2);
      var median = (count % 2) ? values[mid] : (values[mid-1] + values[mid])/2;

      var stddev = Math.sqrt(sumOfDiffs / count);
      current_timer_data["std"] = stddev;
      current_timer_data["upper"] = max;
      current_timer_data["lower"] = min;
      current_timer_data["count"] = timer_counters[key];
      current_timer_data["count_ps"] = timer_counters[key] / (flushInterval / 1000);
      current_timer_data["sum"] = sum;
      current_timer_data["sum_squares"] = sumSquares;
      current_timer_data["mean"] = mean;
      current_timer_data["median"] = median;

      // note: values bigger than the upper limit of the last bin are ignored, by design
      conf = histogram || [];
      bins = [];
      for (var i = 0; i &lt; conf.length; i++) {
          if (key.indexOf(conf[i].metric) &gt; -1) {
              bins = conf[i].bins;
              break;
          }
      }
      if(bins.length) {
          current_timer_data['histogram'] = {};
      }
      // the outer loop iterates bins, the inner loop iterates timer values;
      // within each run of the inner loop we should only consider the timer value range that's within the scope of the current
bin
      // so we leverage the fact that the values are alread ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.statsd.process_mgmt" id="apidoc.module.statsd.process_mgmt">module statsd.process_mgmt</a></h1>


    <h2>
        <a href="#apidoc.element.statsd.process_mgmt.init" id="apidoc.element.statsd.process_mgmt.init">
        function <span class="apidocSignatureSpan">statsd.process_mgmt.</span>init
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">init = function (config) {
  conf = config;
  exports.set_title(config);

  process.on('SIGTERM', function() {
   if (conf.debug) {
     util.log('Starting Final Flush');
   }
   healthStatus = 'down';
   process.exit();
  });

}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  this.backend = this.config.backend || 'stdout';
  this.level   = this.config.level || "LOG_INFO";
  if (this.backend == 'stdout') {
    this.util = require('util');
  } else {
    if (this.backend == 'syslog') {
      this.util = require('modern-syslog');
      this.util.<span class="apidocCodeKeywordSpan">init</span>(config.application || 'statsd', this.util.LOG_PID | this
.util.LOG_ODELAY, this.util.LOG_LOCAL0);
    } else {
      throw "Logger: Should be 'stdout' or 'syslog'.";
    }
  }
};

Logger.prototype = {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.statsd.process_mgmt.set_title" id="apidoc.element.statsd.process_mgmt.set_title">
        function <span class="apidocSignatureSpan">statsd.process_mgmt.</span>set_title
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">set_title = function (config) {
 if (config.title !== undefined) {
   if (config.title) {
       process.title = config.title;
   }
 } else {
   // Respect command line arguments when overriding the process title.
   cmdline = process.argv.slice(2);
   cmdline.unshift('statsd');

   process.title = cmdline.join(" ");
 }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

var util = require('util');

var conf;

exports.init = function(config) {
conf = config;
exports.<span class="apidocCodeKeywordSpan">set_title</span>(config);

process.on('SIGTERM', function() {
 if (conf.debug) {
   util.log('Starting Final Flush');
 }
 healthStatus = 'down';
 process.exit();
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.statsd.repeater" id="apidoc.module.statsd.repeater">module statsd.repeater</a></h1>


    <h2>
        <a href="#apidoc.element.statsd.repeater.init" id="apidoc.element.statsd.repeater.init">
        function <span class="apidocSignatureSpan">statsd.repeater.</span>init
        <span class="apidocSignatureSpan">(startupTime, config, emitter, logger)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">init = function (startupTime, config, emitter, logger) {
  debug = config.debug;
  l = logger;

  var proto = config.repeaterProtocol;
  if(proto == 'tcp') {
    instance = new TCPRepeaterBackend(startupTime, config, emitter);
  } else {
    instance = new UDPRepeaterBackend(startupTime, config, emitter);
  }

  return true;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  this.backend = this.config.backend || 'stdout';
  this.level   = this.config.level || "LOG_INFO";
  if (this.backend == 'stdout') {
    this.util = require('util');
  } else {
    if (this.backend == 'syslog') {
      this.util = require('modern-syslog');
      this.util.<span class="apidocCodeKeywordSpan">init</span>(config.application || 'statsd', this.util.LOG_PID | this
.util.LOG_ODELAY, this.util.LOG_LOCAL0);
    } else {
      throw "Logger: Should be 'stdout' or 'syslog'.";
    }
  }
};

Logger.prototype = {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.statsd.repeater.stop" id="apidoc.element.statsd.repeater.stop">
        function <span class="apidocSignatureSpan">statsd.repeater.</span>stop
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">stop = function (cb) {
  if(instance) {
    instance.stop(cb);
    instance = null;
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

  return true;
};


exports.stop = function(cb) {
  if(instance) {
    instance.<span class="apidocCodeKeywordSpan">stop</span>(cb);
    instance = null;
  }
};
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.statsd.set" id="apidoc.module.statsd.set">module statsd.set</a></h1>


    <h2>
        <a href="#apidoc.element.statsd.set.Set" id="apidoc.element.statsd.set.Set">
        function <span class="apidocSignatureSpan">statsd.set.</span>Set
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Set = function () {
  this.store = {};
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.statsd.tcp" id="apidoc.module.statsd.tcp">module statsd.tcp</a></h1>


    <h2>
        <a href="#apidoc.element.statsd.tcp.start" id="apidoc.element.statsd.tcp.start">
        function <span class="apidocSignatureSpan">statsd.tcp.</span>start
        <span class="apidocSignatureSpan">(config, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">start = function (config, callback) {
  var server = net.createServer(function(stream) {
      stream.setEncoding('ascii');

      var buffer = '';
      stream.on('data', function(data) {
          buffer += data;
          var offset = buffer.lastIndexOf("\n");
          if (offset &gt; -1) {
             var packet = buffer.slice(0, offset + 1);
             buffer = buffer.slice(offset + 1);
             callback(packet, new rinfo(stream, packet));
          }
      });
  });

  server.on('listening', function() {
    config.socket &amp;&amp; config.socket_mod &amp;&amp; fs.chmod(config.socket, config.socket_mod);
  });

  process.on('exit', function() {
      config.socket &amp;&amp; fs.unlinkSync(config.socket);
  });

  server.listen(config.socket || config.port || 8125, config.address || undefined);
  this.server = server;
  return true;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.statsd.udp" id="apidoc.module.statsd.udp">module statsd.udp</a></h1>


    <h2>
        <a href="#apidoc.element.statsd.udp.start" id="apidoc.element.statsd.udp.start">
        function <span class="apidocSignatureSpan">statsd.udp.</span>start
        <span class="apidocSignatureSpan">(config, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">start = function (config, callback) {
  var udp_version = config.address_ipv6 ? 'udp6' : 'udp4';
  var server = dgram.createSocket(udp_version, callback);

  server.bind(config.port || 8125, config.address || undefined);
  this.server = server;

  return true;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>